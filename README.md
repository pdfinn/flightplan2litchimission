# flightplan2litchimission
`fp2lm` is a command-line tool for converting the output generated by the [Flight Planner](https://github.com/JMG30/flight_planner) plugin for [QGIS](https://www.qgis.org/en/site/) to a [Litchi](https://flylitchi.com) mission.

Usage: `cat [FlightplannerMission].csv | fp2lm [-d] > [LitchiMission].csv`

`-d` sets the distance between projection centres in either meters or feet (feet are automatically convented to meters).  Accepted units are `m`, `ft`, `meters`, and `feet`.

For example, to set the distance between projection centres to 20 meters, use `fp2lm -d 20m`.

## Description

`fp2lm` reads a stream of waypoints generated by Flight Planner for QGIS and prints a stream of properly-structured Litchi Mission waypoints, line-by-line, to standard output (this is to allow subsequent stream editing using another tool, if desired).  I/O redirection may be used to capture the output in a new file for use by Litchi.

## Installing

Pre-compiled binaries are now available for Mac OS, Linux, and Windows 64-bit architectures (if you need something else, let me know) and are available in the project's `bin` directory.  Simply install the executable programme `fp2lm` (`fp2lm.exe` on Windows) in a suitable location and make sure its directory is included in your path.

### Mac OS

1) Create a folder named `bin` in your home folder.  Move the `fp2lm` binary from the download location to the newly-created `bin` folder.
2) Open the Terminal and update your `PATH` to include the `bin` folder with the following command: `export PATH=/Users/[your home folder]/bin:$PATH`
3) To make the update to your `PATH` permanent, run the following command: `open .zshrc` (which, on most systems, will open your shell profile in TextEdit) and add the line of code in Step 2 at the end the file.
4) Save and close the `.zshrc` file.
5) You may now run `fp2lm` from the command line as described above.

### Linux

1) Create a folder named `bin` in your home directory.  Move the `fp2lm` binary from the download location to the newly-created `bin` directory.
2) Open the Terminal and update your `PATH` to include the `bin` folder with the following command: `export PATH=/Users/[your home folder]/bin:$PATH`
3) To make the update to your `PATH` permanent, run the following command: `gedit .profile` (which, on most systems, will open your shell profile in TextEdit) and add the line of code in Step 2 at the end of the file.
4) Save and close the `.profile` file.
5) You may now run `fp2lm` from the command line as described above.

### Windows

Follow the instructions [here](https://learn.microsoft.com/en-us/previous-versions/office/developer/sharepoint-2010/ee537574(v=office.14)) for installing a programme for use by the Windows command line. 


## Building

`go build fp2lm.go`

## Steps to produce a Litchi Mission using QGIS

This guide assumes the reader is already familiar with Litchi, but may need help with the workflow in QGIS.

1) Install the flight_planner plugin from QGIS → [Plugins] → [Manage and Install Plugins...] and search for ‘Flight Planner’.
2) Load the map layer of your choice.  To use Google Earth or OpenStreetMap, select ‘XYZ Tiles’ in your project's browser and add it as a layer to your project by double-clicking or right-clicking and selecting ‘Add Layer to Project’.
3) Scribe your Area of Interest (AoI) by creating a new shapefile layer from [Layer] → [Create Layer] → [New Shapefile Layer].  Select ‘Polygon’ as the Geometry type.  Select the desired points on the map. ℹ️ Depending on the CRS you are using, you may need to change the CRS of the AoI to work with Flight Planner — which requires measurements in meters.
4) Follow the [instructions](https://github.com/JMG30/flight_planner/wiki/Guide) for Flight Planner to plan your flight.  ℹ️ If you are using a DJI drone, you will probably need to add your own camera lens.  Consult the manufacture's specifications.
5) You will need to create latitude and longitude coordinates for use by Litchi.  Fortunately, QGIS makes this easy. With the flight plan generated, select the `waypoints` layer in the newly-created `flight_design` layer group.  Select [Vector] → [Geometry Tools] → [Add Geometry Attributes].  Select your AoI layer, and calculate the latitude and longitude coordinates using an appropriate CRS (for example, EPSG:4326).  Add the new layer to your project.  ℹ️ The newly-created layer will have two new fields for latitude and longitude called `xcoord` and `ycoord`.  You may verify the new values by right-clicking on the layer and selecting Open Attribute Table.
6) Export the new layer with latitude and longitude points added to a CSV file. ℹ️ If the steps were correctly followed, the exported file should have the following header: `️Waypoint Number,X [m],Y [m],Alt. ASL [m],Alt. AGL [m],xcoord,ycoord`
7) Run `fp2lm` against the CSV file as described above.

**_NOTE:_** `fp2lm` expects CSV input in the form of navigation waypoints.  At the time of this writing, Litchi missions are limited to 99 waypoints, thus if waypoints are used to trigger photographs, or other actions, the allowed waypoints will be quickly consumed; therefore, for this workflow, waypoints are only used for course changes required to fly the grid.  Photograph intervals may be set expediently by measuring the distance between projection centres in QGIS and configuring Litchi to photograph at equal distance intervals.  This is a work-around until Litchi adds support for more waypoints, but works very well.